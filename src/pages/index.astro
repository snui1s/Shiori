---
import Layout from "../layouts/Layout.astro";
import { db, Post, desc } from "astro:db";
import { getOptimizedImageUrl } from "../lib/images";

import { Image } from "astro:assets";

const rawPosts = await db
  .select()
  .from(Post)
  .orderBy(desc(Post.createdAt))
  .limit(6);

const posts = rawPosts.map((post, index) => {
  const imageUrl =
    post.imageUrl ||
    "https://placehold.co/600x400/1a1a1a/F63049?text=Image+is+Sleeping...";
  return {
    id: post.slug,
    title: post.title,
    excerpt: post.excerpt,
    date:
      new Date(post.createdAt).toLocaleString("th-TH", {
        year: "numeric",
        month: "short",
        day: "numeric",
        hour: "2-digit",
        minute: "2-digit",
      }) + " ‡∏ô.",
    category: post.category,
    image: getOptimizedImageUrl(imageUrl, 600), // Optimize for grid view
    author: post.author,
  };
});

// Random "Now" data
const listeningOptions = [
  "MF DOOM",
  "Nujabes",
  "Lamp",
  "Ichiko Aoba",
  "Fishmans",
  "Laufey",
  "Cigarettes After Sex",
  "Madvillain",
  "Toe",
  "Quasimoto",
  "Massive Attack",
  "Tatsuro Yamashita",
  "J Dilla",
  "Gorillaz",
];

const readingOptions = [
  "Kitchen",
  "No Longer Human",
  "Norwegian Wood",
  "The Little Prince",
  "Kafka on the Shore",
  "The Decagon House Murders",
  "Goth",
  "Zero to One",
  "Designing Data-Intensive Applications",
  "The Courage to Be Disliked",
  "Sapiens",
  "Atomic Habits",
  "The Alchemist",
  "1984",
  "Man's Search for Meaning",
  "Thinking, Fast and Slow",
  "The Subtle Art of Not Giving a F*ck",
  "Almond",
  "The 7 Habits of Highly Effective People",
  "Deep Work",
  "Never Split the Difference",
  "To Kill a Mockingbird",
  "The Great Gatsby",
  "Animal Farm",
];

const moodOptions = [
  "Cozy & Chill",
  "Melancholic",
  "Productive",
  "Dreamy",
  "Adventure Mode",
  "Deep Work State",
  "Existential Crisis",
  "Mystery Solving",
  "Late Night Debugging",
  "Aspiring PM Energy",
  "Post-Workout High",
  "5cm Per Second Vibe",
];

const nowStatus = {
  listening:
    listeningOptions[Math.floor(Math.random() * listeningOptions.length)],
  reading: readingOptions[Math.floor(Math.random() * readingOptions.length)],
  mood: moodOptions[Math.floor(Math.random() * moodOptions.length)],
};
---

<Layout
  title="Sharing Life & Tech"
  description="‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà Shiori Ê†û - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏ß‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï ‡∏Æ‡∏≤‡∏ß‡∏ó‡∏π ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß ‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏°‡∏±‡πà‡∏ß‡πÜ ‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à"
  type="website"
>
  <section class="relative pt-24 pb-16 md:pt-40 md:pb-32 overflow-hidden">
    <div
      class="container relative z-10 text-center max-w-[900px] mx-auto reveal"
    >
      <h1
        class="text-[2.8rem] md:text-[4.5rem] font-black mb-8 -tracking-[0.03em] leading-[1.1] text-balance"
      >
        Sharing Life through <span class="gradient-text">Blog</span>
      </h1>
      <p
        class="text-lg md:text-xl text-text-muted mb-12 max-w-[600px] mx-auto leading-relaxed stagger-1 reveal"
      >
        ‡∏£‡∏ß‡∏°‡∏Æ‡∏≤‡∏ß‡∏ó‡∏π ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡πÇ‡∏ô‡πà‡∏ô‡∏ô‡∏µ‡πà ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡πá‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏°‡∏±‡πà‡∏ß‡πÜ ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏ß‡πÉ‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï
      </p>
      <div
        class="flex flex-col md:flex-row gap-6 justify-center md:max-w-none max-w-[300px] mx-auto stagger-2 reveal"
      >
        <a
          href="/blog"
          class="py-4 px-10 rounded-full font-bold bg-primary text-white transition-all duration-400 hover:bg-secondary hover:-translate-y-1 hover:shadow-[0_15px_30px_-10px_#f63049] no-underline"
        >
          ‡∏≠‡πà‡∏≤‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        </a>
      </div>
    </div>
  </section>

  <section id="featured" class="py-16">
    <div class="container">
      <div class="mb-12 flex flex-col items-center text-center">
        <h2 class="text-2xl md:text-3xl mb-2 font-bold text-white">
          ‡∏ä‡πà‡∏ß‡∏á‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ö‡πâ‡∏≤‡∏á
        </h2>
        <div class="w-[60px] h-1 bg-primary rounded-sm"></div>
      </div>

      <div
        class="grid grid-cols-1 md:grid-cols-[repeat(auto-fill,minmax(350px,1fr))] gap-10 mb-24"
      >
        {
          posts.length > 0 ? (
            posts.map((post, index) => (
              <article
                class={`reveal stagger-${(index % 3) + 1} group post-card glass-premium overflow-hidden transition-all duration-500 hover:-translate-y-2 hover:border-primary/40 flex flex-col rounded-[2rem]`}
              >
                <div class="h-[220px] overflow-hidden bg-white/5">
                  <Image
                    src={post.image}
                    alt={post.title}
                    width={600}
                    height={400}
                    loading="lazy"
                    decoding="async"
                    class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                  />
                </div>
                <div class="p-8 flex flex-col flex-1">
                  <span class="inline-block text-primary font-bold text-[0.8rem] uppercase tracking-widest mb-3">
                    {post.category}
                  </span>
                  <h3 class="text-xl md:text-2xl font-bold mb-4 leading-snug">
                    <a
                      href={`/blog/${post.id}`}
                      class="text-white no-underline transition-colors hover:text-primary"
                    >
                      {post.title}
                    </a>
                  </h3>
                  <p class="text-text-muted text-[0.95rem] leading-relaxed line-clamp-2 mt-auto">
                    {post.excerpt}
                  </p>
                  <div class="pt-8 mt-6 border-t border-white/5 flex justify-between items-center text-[0.8rem] text-text-muted/60 font-medium">
                    <span>{post.date}</span>
                    <span class="flex items-center gap-2">
                      <div class="w-1 h-1 bg-primary rounded-full" />
                      {post.author}
                    </span>
                  </div>
                </div>
              </article>
            ))
          ) : (
            <div class="empty-state glass p-16 text-center text-lg text-text-muted col-span-full">
              <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡πÄ‡∏•‡∏¢ ‡∏£‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡πâ‡∏≤‡∏≤</p>
            </div>
          )
        }
      </div>
    </div>
  </section>

  <section class="mb-16 md:mb-32">
    <div class="container">
      <div
        class="now-card glass-premium p-8 md:p-16 mx-auto max-w-[1000px] relative overflow-hidden text-center reveal rounded-[3rem]"
      >
        <div class="flex items-center gap-4 mb-10 justify-center">
          <span
            class="pulse-icon w-3 h-3 bg-green-400 rounded-full relative shadow-[0_0_10px_#4ade80]"
          ></span>
          <h2 class="text-2xl md:text-3xl font-bold text-white m-0">
            ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á...
          </h2>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-8">
          <div
            class="now-item bg-white/[0.03] p-6 rounded-2xl border border-white/5 transition-all duration-300 hover:bg-white/[0.06] hover:-translate-y-1"
          >
            <span
              class="block text-[0.85rem] text-text-muted uppercase tracking-widest mb-2 font-bold"
              >üéß ‡∏ü‡∏±‡∏á</span
            >
            <p class="text-lg font-bold text-white mb-0">
              {nowStatus.listening}
            </p>
          </div>
          <div
            class="now-item bg-white/[0.03] p-6 rounded-2xl border border-white/5 transition-all duration-300 hover:bg-white/[0.06] hover:-translate-y-1"
          >
            <span
              class="block text-[0.85rem] text-text-muted uppercase tracking-widest mb-2 font-bold"
              >üìñ ‡∏≠‡πà‡∏≤‡∏ô</span
            >
            <p class="text-lg font-bold text-white mb-0">{nowStatus.reading}</p>
          </div>
          <div
            class="now-item bg-white/[0.03] p-6 rounded-2xl border border-white/5 transition-all duration-300 hover:bg-white/[0.06] hover:-translate-y-1"
          >
            <span
              class="block text-[0.85rem] text-text-muted uppercase tracking-widest mb-2 font-bold"
              >‚ú® ‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å</span
            >
            <p class="text-lg font-bold text-white mb-0">{nowStatus.mood}</p>
          </div>
        </div>

        <div class="mt-10 text-text-muted text-sm italic opacity-70">
          <p>‡πÅ‡∏ß‡∏∞‡∏°‡∏≤‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡πÄ‡∏¢‡∏µ‡∏¢‡∏ô‡∏Å‡∏±‡∏ô‡∏ö‡πà‡∏≠‡∏¢‡πÜ‡∏ô‡∏∞</p>
        </div>
      </div>
    </div>
  </section>
</Layout>

<style>
  .pulse-icon::after {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100%;
    height: 100%;
    background: #4ade80;
    border-radius: 50%;
    animation: pulse 2s infinite;
  }
  @keyframes pulse {
    0% {
      transform: translate(-50%, -50%) scale(1);
      opacity: 0.6;
    }
    100% {
      transform: translate(-50%, -50%) scale(3);
      opacity: 0;
    }
  }
</style>
