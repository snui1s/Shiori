---
import Layout from "../../layouts/Layout.astro";
import Editor from "../../components/Editor";
import "../../styles/admin.css";

import { getSession } from "auth-astro/server";

export const prerender = false;

const session = await getSession(Astro.request);
const isAuthorized =
  session?.user &&
  (session.user.email === import.meta.env.ADMIN_EMAIL ||
    session.user.role === "admin");

if (!isAuthorized) {
  return Astro.redirect("/admin");
}
---

<script
  is:inline
  src="https://upload-widget.cloudinary.com/global/all.js"
  type="text/javascript"></script>

<Layout title="เขียนบันทึกใหม่ | Shiori">
  <div class="container admin-page">
    <div class="admin-dashboard-layout">
      <div class="admin-header">
        <div class="header-content">
          <h1 class="h-gradient">เขียนบันทึกใหม่</h1>
          <p>ถ่ายทอดความทรงจำลงบนหน้ากระดาษดิจิทัล</p>
        </div>
        <a href="/admin" class="btn btn-outline">ยกเลิกและกลับ</a>
      </div>
      <Editor client:load />
    </div>
  </div>
</Layout>

<style>
  .admin-page {
    padding: 40px 0;
  }
  .admin-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
  }
  .admin-header h1 {
    margin: 0;
  }
</style>
